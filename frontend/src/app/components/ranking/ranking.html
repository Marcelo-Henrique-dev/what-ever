<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h4><i class="bi bi-trophy"></i> Ranking de Jogadores</h4>
        </div>
        <div class="card-body">
          <div *ngIf="loading" class="text-center">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Carregando...</span>
            </div>
          </div>
          
          <div *ngIf="!loading && players.length === 0" class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> Nenhum jogador no ranking ainda.
            <br>
            <a routerLink="/player" class="btn btn-primary mt-2">
              <i class="bi bi-person-plus"></i> Cadastrar Jogador
            </a>
          </div>
          
          <div *ngIf="players.length > 0">
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="sortBy" class="form-label">Ordenar por:</label>
                <select 
                  class="form-select" 
                  id="sortBy" 
                  [(ngModel)]="sortBy"
                  (ngModelChange)="sortPlayers()">
                  <option value="pontuacao">PontuaÃ§Ã£o Total</option>
                  <option value="partidas">NÃºmero de Partidas</option>
                  <option value="media">MÃ©dia de PontuaÃ§Ã£o</option>
                  <option value="nome">Nome</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="filterBy" class="form-label">Filtrar:</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="filterBy" 
                  placeholder="Buscar jogador..."
                  [(ngModel)]="filterText"
                  (input)="filterPlayers()">
              </div>
            </div>

            <div class="row mb-5" *ngIf="sortedPlayers.length >= 3">
              <div class="col-md-4">
                <div class="card bg-light text-center">
                  <div class="card-body">
                    <div class="mb-3">
                      <i class="bi bi-trophy-fill text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">ðŸ¥‡ 1Âº Lugar</h5>
                    <h6>{{ sortedPlayers[0].nome }}</h6>
                    <p class="card-text">
                      <strong>{{ sortedPlayers[0].pontuacao || 0 }}</strong> pontos<br>
                      <small>{{ sortedPlayers[0].partidas || 0 }} partidas</small>
                    </p>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card bg-light text-center">
                  <div class="card-body">
                    <div class="mb-3">
                      <i class="bi bi-trophy-fill text-secondary" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="card-title">ðŸ¥ˆ 2Âº Lugar</h5>
                    <h6>{{ sortedPlayers[1].nome }}</h6>
                    <p class="card-text">
                      <strong>{{ sortedPlayers[1].pontuacao || 0 }}</strong> pontos<br>
                      <small>{{ sortedPlayers[1].partidas || 0 }} partidas</small>
                    </p>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card bg-light text-center">
                  <div class="card-body">
                    <div class="mb-3">
                      <i class="bi bi-trophy-fill" style="font-size: 3rem; color: #CD7F32;"></i>
                    </div>
                    <h5 class="card-title">ðŸ¥‰ 3Âº Lugar</h5>
                    <h6>{{ sortedPlayers[2].nome }}</h6>
                    <p class="card-text">
                      <strong>{{ sortedPlayers[2].pontuacao || 0 }}</strong> pontos<br>
                      <small>{{ sortedPlayers[2].partidas || 0 }} partidas</small>
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead class="table-dark">
                  <tr>
                    <th>PosiÃ§Ã£o</th>
                    <th>Nome</th>
                    <th>PontuaÃ§Ã£o Total</th>
                    <th>Partidas</th>
                    <th>MÃ©dia/PontuaÃ§Ã£o</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let player of sortedPlayers; let i = index" 
                      [class.table-warning]="i < 3"
                      [class.table-success]="i === 0">
                    <td>
                      <span *ngIf="i === 0">ðŸ¥‡</span>
                      <span *ngIf="i === 1">ðŸ¥ˆ</span>
                      <span *ngIf="i === 2">ðŸ¥‰</span>
                      {{ i + 1 }}
                    </td>
                    <td>
                      <strong>{{ player.nome }}</strong>
                    </td>
                    <td>
                      <span class="badge bg-primary">{{ player.pontuacao || 0 }}</span>
                    </td>
                    <td>{{ player.partidas || 0 }}</td>
                    <td>
                      <span class="badge bg-info">{{ calculateAverage(player) }}</span>
                    </td>
                    <td>
                      <span *ngIf="player.partidas === 0" class="badge bg-secondary">Iniciante</span>
                      <span *ngIf="player.partidas && player.partidas > 0 && player.partidas <= 5" class="badge bg-success">Jogador</span>
                      <span *ngIf="player.partidas && player.partidas > 5 && player.partidas <= 10" class="badge bg-warning text-dark">Experiente</span>
                      <span *ngIf="player.partidas && player.partidas > 10" class="badge bg-danger">Mestre</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="row mt-4">
              <div class="col-md-3">
                <div class="card bg-primary text-white">
                  <div class="card-body text-center">
                    <h5>{{ players.length }}</h5>
                    <p class="mb-0">Total de Jogadores</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card bg-success text-white">
                  <div class="card-body text-center">
                    <h5>{{ getTotalScore() }}</h5>
                    <p class="mb-0">Pontos Totais</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card bg-info text-white">
                  <div class="card-body text-center">
                    <h5>{{ getTotalGames() }}</h5>
                    <p class="mb-0">Partidas Totais</p>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card bg-warning text-dark">
                  <div class="card-body text-center">
                    <h5>{{ getAverageScore() }}</h5>
                    <p class="mb-0">MÃ©dia Geral</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center mt-4">
              <button class="btn btn-primary" (click)="refreshRanking()">
                <i class="bi bi-arrow-clockwise"></i> Atualizar Ranking
              </button>
              <a routerLink="/quiz" class="btn btn-success ms-2">
                <i class="bi bi-play-circle"></i> Jogar
              </a>
              <a routerLink="/home" class="btn btn-secondary ms-2">
                <i class="bi bi-house"></i> InÃ­cio
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="position-fixed top-0 end-0 p-3" style="z-index: 11">
  <div class="toast show" role="alert" *ngIf="message">
    <div class="toast-header" [ngClass]="messageType === 'success' ? 'bg-success text-white' : 'bg-danger text-white'">
      <strong class="me-auto">NotificaÃ§Ã£o</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" (click)="clearMessage()"></button>
    </div>
    <div class="toast-body">
      {{ message }}
    </div>
  </div>
</div>